<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Incident Creation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test Incident Creation & Overview</h1>
    
    <div class="test-container">
        <h2>Teste Incident Overview FunktionalitÃ¤t</h2>
        <p>Dieser Test erstellt Beispiel-UnfÃ¤lle und Beinahe-UnfÃ¤lle zum Testen der neuen "VorfÃ¤lle verwalten" Sektion.</p>
        
        <button onclick="createTestIncidents()">ğŸ“‹ Test-VorfÃ¤lle erstellen</button>
        <button onclick="clearAllIncidents()">ğŸ—‘ï¸ Alle VorfÃ¤lle lÃ¶schen</button>
        <button onclick="checkIncidentCount()">ğŸ“Š Anzahl prÃ¼fen</button>
        <button onclick="openMainSystem()">ğŸ  Hauptsystem Ã¶ffnen</button>
        
        <div id="testResults"></div>
    </div>

    <script>
        function createTestIncidents() {
            log('ğŸš€ Erstelle Test-VorfÃ¤lle...');
            
            const testIncidents = [
                // Unfall 1
                {
                    id: 'test-accident-' + Date.now() + '-1',
                    type: 'accident',
                    incidentDateTime: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5 Tage her
                    incidentLocation: 'Produktionshalle A, Arbeitsplatz 12',
                    incidentDescription: 'Mitarbeiter ist von der Leiter gefallen wÃ¤hrend der Wartung der Maschine XY-450. Der Mitarbeiter rutschte auf der 3. Sprosse aus und fiel ca. 2 Meter tief. Sofortige erste Hilfe wurde geleistet.',
                    severity: 'mittel',
                    status: 'in_bearbeitung',
                    reporterName: 'Max Mustermann',
                    reporterDepartment: 'Produktion',
                    reporterPosition: 'Abteilungsleiter',
                    affectedPersonName: 'Thomas Schmidt',
                    immediateMeasures: 'Erste Hilfe geleistet, Rettungsdienst verstÃ¤ndigt, Arbeitsplatz abgesperrt, Leiter aus dem Verkehr gezogen',
                    preventiveMeasures: 'Leiter-Inspektion verstÃ¤rken, rutschfeste Sprossen installieren, Sicherheitstraining fÃ¼r alle Mitarbeiter',
                    witnesses: 'Anna Weber, Peter MÃ¼ller',
                    createdAt: new Date().toISOString()
                },
                
                // Unfall 2
                {
                    id: 'test-accident-' + Date.now() + '-2',
                    type: 'accident',
                    incidentDateTime: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 Tage her
                    incidentLocation: 'Lager B, Gang 7',
                    incidentDescription: 'Schnittverletzung an der rechten Hand beim Ã–ffnen einer Verpackung mit defektem Cutter-Messer. Die Klinge war stumpf und ist abgerutscht.',
                    severity: 'niedrig',
                    status: 'abgeschlossen',
                    reporterName: 'Lisa Wagner',
                    reporterDepartment: 'Logistik',
                    reporterPosition: 'Lagermitarbeiterin',
                    affectedPersonName: 'Lisa Wagner',
                    immediateMeasures: 'Wunde desinfiziert und verbunden, BetriebssanitÃ¤ter informiert',
                    preventiveMeasures: 'RegelmÃ¤ÃŸiger Austausch der Cutter-Klingen, Sicherheitshandschuhe bereitstellen',
                    witnesses: '',
                    createdAt: new Date().toISOString()
                },
                
                // Beinahe-Unfall 1
                {
                    id: 'test-nearmiss-' + Date.now() + '-1',
                    type: 'near_miss',
                    incidentDateTime: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(), // 1 Tag her
                    incidentLocation: 'Eingangsbereich HauptgebÃ¤ude',
                    incidentDescription: 'Palette mit Waren war instabil gestapelt und drohte umzufallen. Ein Mitarbeiter bemerkte die Gefahr rechtzeitig und konnte die Palette stabilisieren. Keine Verletzungen.',
                    severity: 'niedrig',
                    status: 'offen',
                    reporterName: 'Peter Weber',
                    reporterDepartment: 'Logistik',
                    reporterPosition: 'Staplerfahrer',
                    affectedPersonName: '',
                    immediateMeasures: 'Palette neu gestapelt und gesichert, Bereich temporÃ¤r abgesperrt',
                    preventiveMeasures: 'Schulung zu korrekter Palettenstapelung, bessere Kennzeichnung von Stapelgrenzen',
                    witnesses: 'Maria Rodriguez',
                    createdAt: new Date().toISOString()
                },
                
                // Beinahe-Unfall 2
                {
                    id: 'test-nearmiss-' + Date.now() + '-2',
                    type: 'near_miss',
                    incidentDateTime: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), // 1 Woche her
                    incidentLocation: 'Werkstatt, Drehbank 3',
                    incidentDescription: 'WÃ¤hrend der Bearbeitung eines WerkstÃ¼cks lÃ¶ste sich die Spannvorrichtung. Das WerkstÃ¼ck flog durch die Werkstatt, verfehlte aber knapp einen Kollegen. Maschine wurde sofort gestoppt.',
                    severity: 'hoch',
                    status: 'in_bearbeitung',
                    reporterName: 'Klaus Hoffmann',
                    reporterDepartment: 'Fertigung',
                    reporterPosition: 'Werkstattleiter',
                    affectedPersonName: '',
                    immediateMeasures: 'Maschine stillgelegt, Sicherheitsbereich erweitert, technische PrÃ¼fung eingeleitet',
                    preventiveMeasures: 'Wartungsintervalle verkÃ¼rzen, zusÃ¤tzliche Schutzvorrichtungen installieren, Schulung zu Spannvorrichtungen',
                    witnesses: 'Frank Neumann, Sandra Klein',
                    createdAt: new Date().toISOString()
                },
                
                // Kritischer Unfall
                {
                    id: 'test-critical-' + Date.now() + '-1',
                    type: 'accident',
                    incidentDateTime: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString(), // 3 Stunden her
                    incidentLocation: 'Chemielager, Regal 15',
                    incidentDescription: 'Beim Transport von Chemikalien ist ein BehÃ¤lter mit SÃ¤ure undicht geworden. Der Mitarbeiter erlitt VerÃ¤tzungen an HÃ¤nden und Unterarmen. Sofortige NotfallmaÃŸnahmen eingeleitet.',
                    severity: 'kritisch',
                    status: 'offen',
                    reporterName: 'Dr. Sarah Meyer',
                    reporterDepartment: 'QualitÃ¤tskontrolle',
                    reporterPosition: 'Labourleitung',
                    affectedPersonName: 'Michael Braun',
                    immediateMeasures: 'Notarzt gerufen, betroffene Bereiche gespÃ¼lt, Chemielager evakuiert, Feuerwehr informiert',
                    preventiveMeasures: 'BehÃ¤lter-PrÃ¼fungsverfahren Ã¼berarbeiten, verstÃ¤rkte SchutzausrÃ¼stung, Notfallverfahren trainieren',
                    witnesses: 'Jennifer Schmidt, Robert Fischer',
                    createdAt: new Date().toISOString()
                }
            ];
            
            // Speichere in localStorage
            try {
                const existingIncidents = JSON.parse(localStorage.getItem('qhse_incidents') || '[]');
                const newIncidents = [...existingIncidents, ...testIncidents];
                localStorage.setItem('qhse_incidents', JSON.stringify(newIncidents));
                
                log(`âœ… ${testIncidents.length} Test-VorfÃ¤lle erfolgreich erstellt!`);
                log(`ğŸ“Š Gesamt in localStorage: ${newIncidents.length} VorfÃ¤lle`);
                
                // Zeige Zusammenfassung
                const summary = testIncidents.reduce((acc, inc) => {
                    acc[inc.type] = (acc[inc.type] || 0) + 1;
                    return acc;
                }, {});
                
                log(`ğŸ“‹ Erstellt: ${summary.accident || 0} UnfÃ¤lle, ${summary.near_miss || 0} Beinahe-UnfÃ¤lle`);
                
            } catch (error) {
                log(`âŒ Fehler beim Speichern: ${error.message}`);
            }
        }
        
        function clearAllIncidents() {
            if (confirm('Alle VorfÃ¤lle lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) {
                localStorage.removeItem('qhse_incidents');
                log('ğŸ—‘ï¸ Alle VorfÃ¤lle wurden gelÃ¶scht');
            }
        }
        
        function checkIncidentCount() {
            try {
                const incidents = JSON.parse(localStorage.getItem('qhse_incidents') || '[]');
                const accidents = incidents.filter(inc => inc.type === 'accident').length;
                const nearMiss = incidents.filter(inc => inc.type === 'near_miss').length;
                
                log(`ğŸ“Š Aktueller Stand:`);
                log(`   â€¢ Gesamt: ${incidents.length} VorfÃ¤lle`);
                log(`   â€¢ UnfÃ¤lle: ${accidents}`);
                log(`   â€¢ Beinahe-UnfÃ¤lle: ${nearMiss}`);
                
                // Zeige Status-Verteilung
                const statusCount = incidents.reduce((acc, inc) => {
                    const status = inc.status || 'offen';
                    acc[status] = (acc[status] || 0) + 1;
                    return acc;
                }, {});
                
                log(`   â€¢ Status: ${JSON.stringify(statusCount)}`);
                
            } catch (error) {
                log(`âŒ Fehler beim Laden: ${error.message}`);
            }
        }
        
        function openMainSystem() {
            window.open('index.html', '_blank');
        }
        
        function log(message) {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = message.includes('âœ…') ? 'success' : 'info';
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
            console.log(message);
            
            // Keep only last 15 entries
            while (results.children.length > 15) {
                results.removeChild(results.firstChild);
            }
        }
        
        // Auto-check on page load
        window.addEventListener('load', () => {
            checkIncidentCount();
        });
    </script>
</body>
</html>