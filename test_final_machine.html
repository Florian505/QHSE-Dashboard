<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Final Machine Test</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Inter, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            min-height: 100vh;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .success-button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1.5rem 2rem;
            border: none;
            border-radius: 1rem;
            cursor: pointer;
            margin: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            width: calc(50% - 2rem);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .success-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        .status {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-family: 'Courier New', monospace;
            min-height: 150px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .header h1 {
            color: #1f2937;
            margin: 0;
            font-size: 2rem;
        }
        .header p {
            color: #6b7280;
            margin: 0.5rem 0 0 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>🎯 Machine Management - Final Test</h1>
            <p>Teste das reparierte Maschinenmanagement-System</p>
        </div>
        
        <div style="text-align: center;">
            <button class="success-button" onclick="testWorkingModal()">
                <i class="fas fa-cogs"></i>
                Funktionierendes Modal testen
            </button>
            
            <a href="index.html" class="success-button" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                <i class="fas fa-home"></i>
                Zurück zum Hauptsystem
            </a>
        </div>
        
        <div style="text-align: center; margin: 2rem 0;">
            <button class="success-button" onclick="testOriginalFunction()" style="background: linear-gradient(135deg, #f59e0b, #d97706); width: calc(100% - 2rem);">
                <i class="fas fa-bug"></i>
                Original Funktion testen (Debug)
            </button>
        </div>
        
        <div class="status" id="status">
🚀 System bereit für Tests...

Verfügbare Tests:
✅ Funktionierendes Modal - Verwendet die reparierte createWorkingMachineModal() Funktion
🏠 Hauptsystem - Teste im echten QHSE Dashboard
🐛 Debug - Teste die Original showAddMachineModal() Funktion

Wählen Sie einen Test aus!
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function log(message) {
            const status = document.getElementById('status');
            const time = new Date().toLocaleTimeString();
            status.textContent += `\n${time}: ${message}`;
            status.scrollTop = status.scrollHeight;
        }

        function testWorkingModal() {
            log('🧪 Teste funktionierendes Modal...');
            
            try {
                if (!window.qhseDashboard) {
                    log('❌ QHSE Dashboard nicht geladen');
                    return;
                }
                
                log('✅ Dashboard gefunden');
                
                // Test working modal function
                if (typeof window.qhseDashboard.createWorkingMachineModal === 'function') {
                    log('✅ createWorkingMachineModal Funktion gefunden');
                    
                    // Remove existing modals
                    const existing = document.getElementById('addMachineModal');
                    if (existing) existing.remove();
                    
                    // Create and show modal
                    const modal = window.qhseDashboard.createWorkingMachineModal();
                    document.body.appendChild(modal);
                    
                    // Focus first field
                    setTimeout(() => {
                        const firstField = modal.querySelector('#machineName');
                        if (firstField) {
                            firstField.focus();
                            log('✅ Modal geöffnet und fokussiert');
                        }
                    }, 100);
                    
                    log('🎉 Funktionierendes Modal erfolgreich geöffnet!');
                    
                } else {
                    log('❌ createWorkingMachineModal Funktion nicht gefunden');
                }
                
            } catch (error) {
                log('❌ Fehler: ' + error.message);
                console.error('Test error:', error);
            }
        }

        function testOriginalFunction() {
            log('🔍 Teste Original showAddMachineModal...');
            
            try {
                if (window.qhseDashboard) {
                    log('✅ Dashboard gefunden - rufe Original-Funktion auf');
                    window.qhseDashboard.showAddMachineModal();
                    log('✅ Original-Funktion aufgerufen');
                } else {
                    log('❌ Dashboard nicht verfügbar');
                }
            } catch (error) {
                log('❌ Original-Fehler: ' + error.message);
                log('🔧 Versuche Fallback...');
                
                // Try fallback
                try {
                    if (window.qhseDashboard && window.qhseDashboard.showAddMachineModalFixed) {
                        window.qhseDashboard.showAddMachineModalFixed();
                        log('✅ Fallback erfolgreich');
                    }
                } catch (fallbackError) {
                    log('❌ Fallback fehlgeschlagen: ' + fallbackError.message);
                }
            }
        }

        // Auto-check when loaded
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (window.qhseDashboard) {
                    log('✅ QHSE Dashboard erfolgreich geladen');
                    log('📊 Machine Management bereit für Tests');
                    
                    // Check available functions
                    const functions = [
                        'showAddMachineModal',
                        'createWorkingMachineModal', 
                        'createAdvancedMachineModal',
                        'saveWorkingMachine'
                    ];
                    
                    functions.forEach(func => {
                        if (typeof window.qhseDashboard[func] === 'function') {
                            log(`✅ ${func}() verfügbar`);
                        } else {
                            log(`❌ ${func}() nicht gefunden`);
                        }
                    });
                    
                } else {
                    log('❌ Dashboard noch nicht geladen - bitte warten...');
                    
                    // Retry after delay
                    setTimeout(() => {
                        if (window.qhseDashboard) {
                            log('✅ Dashboard nachträglich geladen');
                        } else {
                            log('❌ Dashboard konnte nicht geladen werden');
                            log('💡 Lösung: Öffnen Sie index.html zuerst');
                        }
                    }, 3000);
                }
            }, 1000);
        });

        // Global error handler
        window.addEventListener('error', (e) => {
            log(`💥 JS Fehler: ${e.message} in ${e.filename}:${e.lineno}`);
        });
    </script>
</body>
</html>